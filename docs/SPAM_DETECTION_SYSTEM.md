# –°–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–ø–∞–º–∞

## üìã –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–ø–∞–º-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ ComputeBudget –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö Solana.

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–ø–∞–º–∞:
- **ComputeBudget –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–æ—Ç–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –æ–¥–Ω—É —Å–µ–∫—É–Ω–¥—É
- **–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã** - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å—É–º–º—ã, –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å–ø–∞–º-–ø—Ä–æ—Ü–µ–Ω—Ç–∞:
```
spam_percentage = (compute_budget_instructions / total_instructions) * 100
```

### –ü–æ—Ä–æ–≥–∏ –æ—Ü–µ–Ω–∫–∏:
- **0-25%** = üü¢ –ß–∏—Å—Ç—ã–π
- **25-50%** = üü° –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π  
- **50-70%** = üü† –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
- **70%+** = üî¥ –°–ø–∞–º

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **SpamDetector** (`src/monitoring/spam_detector.py`)
   - –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ Helius RPC
   - –ü–æ–¥—Å—á–µ—Ç ComputeBudget –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
   - –†–∞—Å—á–µ—Ç —Å–ø–∞–º-–º–µ—Ç—Ä–∏–∫

2. **SpamMonitoringService** 
   - –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–ø–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
   - –õ–∏–º–∏—Ç: —Ç–æ–ø-10 —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ —Å–∫–æ—Ä—É

3. **–ó–∞–¥–∞—á–∞ scheduler** (`src/scheduler/tasks.py`)
   - `monitor_spam_once()` - —Ä–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
   - `run_spam_monitor()` - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å**: 0.76s –Ω–∞ —Ç–æ–∫–µ–Ω
- **Batch –∞–Ω–∞–ª–∏–∑**: 0.49s –Ω–∞ —Ç–æ–∫–µ–Ω (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- **–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞**: <2s –¥–ª—è 5-—Å–µ–∫—É–Ω–¥–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

### –ü—Ä–∏–º–µ—Ä—ã –¥–µ—Ç–µ–∫—Ü–∏–∏:
- **J4UBm5kvMSHeUwbNgZW4ySpCHBvS7LXknZ7rqQR9pump**: 64.7% —Å–ø–∞–º (HIGH)
- **WSOL**: 37.6% —Å–ø–∞–º (MEDIUM) - –¥–∞–∂–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
# –¢–µ—Å—Ç –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
python3 scripts/test_spam_detector.py

# –¢–µ—Å—Ç –∑–∞–¥–∞—á–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
python3 scripts/test_spam_monitoring.py

# –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
python3 scripts/analyze_spam_transactions.py
```

### –ó–∞–ø—É—Å–∫ daemon:
```bash
# –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
python3 scripts/run_spam_monitor_daemon.py
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ scheduler:
```python
from src.scheduler.tasks import run_spam_monitor

# –î–æ–±–∞–≤–∏—Ç—å –≤ APScheduler —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 5 —Å–µ–∫—É–Ω–¥
scheduler.add_job(run_spam_monitor, 'interval', seconds=5)
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏ —Å–ø–∞–º-–¥–µ—Ç–µ–∫—Ü–∏–∏:
- `spam_monitor_start` - –Ω–∞—á–∞–ª–æ —Ü–∏–∫–ª–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `high_spam_detected` - –æ–±–Ω–∞—Ä—É–∂–µ–Ω —Ç–æ–∫–µ–Ω —Å –≤—ã—Å–æ–∫–∏–º —Å–ø–∞–º–æ–º
- `spam_monitor_complete` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ø–∞–º-–º–µ—Ç—Ä–∏–∫:
```json
{
  "spam_percentage": 64.7,
  "risk_level": "high",
  "total_instructions": 85,
  "compute_budget_count": 55,
  "transfer_count": 12,
  "system_count": 4
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `HELIUS_API_KEY` - –∫–ª—é—á –¥–ª—è Helius RPC API

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –±–∞–∑–µ:
- `min_score` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–∫–æ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 50.0)

## üéØ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–æ—Ä–∏–Ω–≥**:
   - –î–æ–±–∞–≤–∏—Ç—å —Å–ø–∞–º-–ø—Ä–æ—Ü–µ–Ω—Ç –∫–∞–∫ —à—Ç—Ä–∞—Ñ–Ω–æ–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
   - –°–Ω–∏–∂–∞—Ç—å —Å–∫–æ—Ä —Ç–æ–∫–µ–Ω–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º —Å–ø–∞–º–æ–º

2. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤**:
   - –ê–Ω–∞–ª–∏–∑ –∫–æ—à–µ–ª—å–∫–æ–≤ (–≤–æ–∑—Ä–∞—Å—Ç, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
   - –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å—É–º–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏

3. **–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**:
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `spam_metrics` –≤ `TokenScore`
   - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–ø–∞–º-—É—Ä–æ–≤–Ω—è
   - API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∞–º-–¥–∞–Ω–Ω—ã—Ö

4. **–ê–ª–µ—Ä—Ç—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã—Å–æ–∫–æ–º —Å–ø–∞–º–µ
   - Dashboard —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–ø–∞–º-–º–µ—Ç—Ä–∏–∫
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∞–º–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞:
```python
from src.monitoring.spam_detector import analyze_single_token

result = await analyze_single_token("J4UBm5kvMSHeUwbNgZW4ySpCHBvS7LXknZ7rqQR9pump")
print(f"Spam level: {result['spam_metrics']['spam_percentage']:.1f}%")
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```python
from src.adapters.repositories.tokens_repo import TokensRepository

repo = TokensRepository(db)
tokens = repo.get_active_tokens_above_score(min_score=50.0)
print(f"Found {len(tokens)} tokens for spam monitoring")
```

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–æ–∫–µ–Ω–æ–≤.