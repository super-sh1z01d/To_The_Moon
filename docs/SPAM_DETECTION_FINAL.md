# –°–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–ø–∞–º–∞ - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –°–ø–∞–º-–¥–µ—Ç–µ–∫—Ç–æ—Ä (src/monitoring/spam_detector.py)
- –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ Helius RPC
- –ü–æ–¥—Å—á–µ—Ç ComputeBudget –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- –†–∞—Å—á–µ—Ç —Å–ø–∞–º-–ø—Ä–æ—Ü–µ–Ω—Ç–∞: `(compute_budget / total_instructions) * 100`
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ~1.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ç–æ–∫–µ–Ω

### 2. –ü–æ—Ä–æ–≥–∏ –æ—Ü–µ–Ω–∫–∏
- **0-25%** = üü¢ Clean (—á–∏—Å—Ç—ã–π)
- **25-50%** = üü° Low (–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π)  
- **50-70%** = üü† Medium (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)
- **70%+** = üî¥ High (—Å–ø–∞–º)

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª**: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- **–ü–æ—Ä–æ–≥**: —Ç–æ–∫–µ–Ω—ã —Å–æ —Å–∫–æ—Ä–æ–º >= `notarb_min_score` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.0)
- **–ó–∞–¥–∞—á–∞**: `run_spam_monitor` –≤ scheduler
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –ø–æ–ª–µ `spam_metrics` —Ç–∞–±–ª–∏—Ü—ã `token_scores`

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
- **–ö–æ–ª–æ–Ω–∫–∞ "–°–ø–∞–º"** –∑–∞–º–µ–Ω–∏–ª–∞ "–ü—É–ª—ã (USD1)"
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `SpamCell.tsx` —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π
- **API**: –ø–æ–ª–µ `spam_metrics` –≤ `/tokens` endpoint
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –ø—Ä–æ—Ü–µ–Ω—Ç + –∏–∫–æ–Ω–∫–∞ —Ä–∏—Å–∫–∞

### 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞**: —Å–ø–∞–º-–¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è–ª–∏—Å—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–∫–æ—Ä–∞
- **–†–µ—à–µ–Ω–∏–µ**: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `spam_metrics` –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ snapshot
- **–§—É–Ω–∫—Ü–∏—è**: `insert_score_snapshot` –≤ `TokensRepository`

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ß–∏—Å—Ç—ã–π —Ç–æ–∫–µ–Ω (PumpFun Doge):
```json
{
  "spam_percentage": 2.63,
  "risk_level": "clean",
  "total_instructions": 76,
  "compute_budget_count": 2
}
```

### –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω (Cap):
```json
{
  "spam_percentage": 49.47,
  "risk_level": "low",
  "total_instructions": 95,
  "compute_budget_count": 47
}
```

### –°–ø–∞–º-—Ç–æ–∫–µ–Ω:
```json
{
  "spam_percentage": 71.4,
  "risk_level": "high",
  "total_instructions": 85,
  "compute_budget_count": 55
}
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ –ë–î:
```bash
sqlite3 dev.db 'ALTER TABLE token_scores ADD COLUMN spam_metrics JSON;'
```

### –ó–∞–ø—É—Å–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
cd /srv/tothemoon
git pull origin main
systemctl restart tothemoon
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:
```bash
# –õ–æ–≥–∏ —Å–ø–∞–º-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
journalctl -u tothemoon --since '1 minute ago' | grep spam_monitor

# API —Å —Å–ø–∞–º-–¥–∞–Ω–Ω—ã–º–∏
curl http://localhost:8000/tokens?limit=5
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ê–Ω–∞–ª–∏–∑ 1 —Ç–æ–∫–µ–Ω–∞**: ~1.5 —Å–µ–∫—É–Ω–¥—ã
- **–ê–Ω–∞–ª–∏–∑ 2 —Ç–æ–∫–µ–Ω–æ–≤**: ~3 —Å–µ–∫—É–Ω–¥—ã
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª**: 5 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–æ–ø—É—Å–∫–∏**: –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç–æ–∫–µ–Ω–æ–≤

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–æ—Ä–æ–≥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```sql
UPDATE app_settings SET value = '1.0' WHERE key = 'notarb_min_score';
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞:
–í `src/scheduler/service.py`:
```python
scheduler.add_job(
    run_spam_monitor, 
    IntervalTrigger(seconds=5),  # –ò–∑–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å
    id="spam_monitor"
)
```

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –°–ø–∞–º-–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø–∞–¥–∞—é—Ç
**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ score snapshot, spam_metrics –Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏—Å—å  
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ snapshot

### 2. –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ
**–ü—Ä–∏—á–∏–Ω–∞**: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ RPC –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è  
**–†–µ—à–µ–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–æ 20

### 3. –ù–µ –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Ä–æ–≥ `notarb_min_score`, –∞ –Ω–µ `min_score`  
**–†–µ—à–µ–Ω–∏–µ**: –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ - –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω—ã –¥–ª—è NotArb

## üìù –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

### Backend:
- `src/monitoring/spam_detector.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–µ—Ç–µ–∫—Ç–æ—Ä
- `src/scheduler/tasks.py` - –∑–∞–¥–∞—á–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `src/scheduler/service.py` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á–∏
- `src/adapters/repositories/tokens_repo.py` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `src/app/routes/tokens.py` - API endpoint

### Frontend:
- `frontend/src/components/SpamCell.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `frontend/src/pages/Dashboard.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É
- `frontend/src/lib/api.ts` - —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### –°–∫—Ä–∏–ø—Ç—ã:
- `scripts/test_spam_detector.py` - —Ç–µ—Å—Ç—ã –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞
- `scripts/test_spam_monitoring.py` - —Ç–µ—Å—Ç –∑–∞–¥–∞—á–∏
- `scripts/analyze_spam_transactions.py` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- `scripts/run_spam_monitor_daemon.py` - standalone daemon

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

–°–∏—Å—Ç–µ–º–∞ —Å–ø–∞–º-–¥–µ—Ç–µ–∫—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–æ–∫–µ–Ω–æ–≤ –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞ NotArb
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–∫–æ—Ä–æ–≤
- ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ö–æ–ª–æ–Ω–∫–∞ "–°–ø–∞–º" —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç —Å–ø–∞–º-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥ NotArb –±–æ—Ç–∞.