# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–∫–æ—Ä–æ–≤ ‚Äî –ø–æ–ª–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç —É–ª—É—á—à–µ–Ω–∏–π

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–°–∫–æ—Ä—ã —Ç–æ–∫–µ–Ω–æ–≤ —Å–∏–ª—å–Ω–æ –∫–æ–ª–µ–±–∞–ª–∏—Å—å, —á—Ç–æ –¥–µ–ª–∞–ª–æ —Å–∏—Å—Ç–µ–º—É –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–æ–π –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞–ª–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ—Ç–µ–Ω –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤** –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–µ—Ä–∏–æ–¥—ã.

## ‚úÖ –†–µ—à–µ–Ω–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 1. üìä –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ —Å–∫–æ—Ä–æ–≤
**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** EMA —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º Œ± = 0.3

```
smoothed_score = Œ± √ó new_score + (1-Œ±) √ó previous_score
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ **81.7%**

### 2. üßÆ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª

#### –ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (s):
```python
# –ë—ã–ª–æ: —Å–ª–∏—à–∫–æ–º —Ä–µ–∑–∫–æ–µ
s = clip(|ŒîP_5m| / 0.1)

# –°—Ç–∞–ª–æ: –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
s = clip(log(1 + |ŒîP_5m| √ó 10) / log(11))
```

#### –ü—Ä–æ–±–ª–µ–º–∞ momentum (m):
```python
# –ë—ã–ª–æ: –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª—ã–µ —á–∏—Å–ª–∞
m = clip(|ŒîP_5m| / (|ŒîP_15m| + 0.001))

# –°—Ç–∞–ª–æ: –∑–∞—â–∏—Ç–∞ –æ—Ç —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
m = clip(|ŒîP_5m| / max(|ŒîP_15m|, 0.01))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### 3. üéõÔ∏è UI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è
**–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ Œ± –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –≤—ã–±–æ—Ä—É –∑–Ω–∞—á–µ–Ω–∏–π
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ñ–æ—Ä–º—É–ª—ã
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ [0.0-1.0]

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: –í–´–°–û–ö–ê–Ø (—Å–∫–∞—á–∫–∏ 50-200%)
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –º–∞–ª—ã—Ö dp15
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: –ù–ò–ó–ö–ê–Ø (–ø–ª–∞–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0-1]
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–≥–æ–¥–Ω–∞ –¥–ª—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–ù–æ–≤–æ–µ –ø–æ–ª–µ:** `smoothed_score` –≤ —Ç–∞–±–ª–∏—Ü–µ `token_scores`
- **–ú–∏–≥—Ä–∞—Ü–∏—è:** `0002_add_smoothed_score`
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –æ–±–∞ —Å–∫–æ—Ä–∞

### API –∏–∑–º–µ–Ω–µ–Ω–∏—è  
- **–û—Å–Ω–æ–≤–Ω—ã–µ endpoint'—ã** –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `smoothed_score`
- **–ò—Å—Ç–æ—Ä–∏—è** —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è
- **–ù–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:** `score_smoothing_alpha`

### UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–î–∞—à–±–æ—Ä–¥:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≥–ª–∞–∂–µ–Ω–Ω—ã–µ —Å–∫–æ—Ä—ã —Å –ø–æ–º–µ—Ç–∫–æ–π "*"
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** –°–µ–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ Œ±
- **–§–æ—Ä–º—É–ª—ã:** –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è:
```bash
# –ß–µ—Ä–µ–∑ API
PUT /settings/score_smoothing_alpha
Content: "0.3"

# –ß–µ—Ä–µ–∑ UI: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ —Å–∫–æ—Ä–æ–≤
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è Œ±:
- **0.1** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥)
- **0.3** ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å ‚úÖ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **0.5** ‚Äî –±—ã—Å—Ç—Ä–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (–¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏)
- **1.0** ‚Äî –±–µ–∑ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è (—Å—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

## üìä –ü—Ä–∏–º–µ—Ä—ã —É–ª—É—á—à–µ–Ω–∏–π

### –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (s):
```
ŒîP_5m = 0.08:
–°—Ç–∞—Ä–∞—è —Ñ–æ—Ä–º—É–ª–∞: s = 0.800 (—Ä–µ–∑–∫–∏–π —Å–∫–∞—á–æ–∫)
–ù–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞:  s = 0.245 (–ø–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ)
```

### Momentum (m) –ø—Ä–∏ –º–∞–ª—ã—Ö dp15:
```
ŒîP_5m = 0.06, ŒîP_15m = 0.002:
–°—Ç–∞—Ä–∞—è —Ñ–æ—Ä–º—É–ª–∞: m = 1.000 (—ç–∫—Å—Ç—Ä–µ–º—É–º)
–ù–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞:  m = 1.000 (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ)
```

### –û–±—â–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è:
```
–ü—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∫–æ—Ä–æ–≤:
–ò—Å—Ö–æ–¥–Ω—ã–µ:   [0.8, 0.3, 0.9, 0.2, 0.7]
–°–≥–ª–∞–∂–µ–Ω–Ω—ã–µ: [0.8, 0.7, 0.8, 0.6, 0.7]
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
```bash
# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è
python3 scripts/test_smoothing.py

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∏ –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º—É–ª  
python3 scripts/test_formula_improvements.py

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å –ë–î
python3 scripts/test_improved_scoring.py
```

## üìã –ú–∏–≥—Ä–∞—Ü–∏—è

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫:
```bash
# 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
python3 -m alembic upgrade head

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
cd frontend && npm run build

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
systemctl restart tothemoon.service
```

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- ‚úÖ **API –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è** ‚Äî –≤—Å–µ endpoint'—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚úÖ **–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ** ‚Äî –¥–ª—è –Ω–∏—Ö `smoothed_score = score` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–µ—Ä–µ—Å—á–µ—Ç–µ
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Äî –µ—Å–ª–∏ Œ± –Ω–µ –∑–∞–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## üéâ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ:** –°–∫–æ—Ä—ã –ø—Ä—ã–≥–∞–ª–∏ —Ö–∞–æ—Ç–∏—á–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
**–ü–æ—Å–ª–µ:** –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å **—Å–Ω–∏–∂–µ–Ω–∏–µ–º –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 80%+** –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
1. üéØ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** ‚Äî –ø–ª–∞–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —Å–∫–∞—á–∫–æ–≤
2. ‚ö° **–û—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. üîß **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ—Å—Ç—å** ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç Œ± –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
4. üìä **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ã –æ–±–∞ —Å–∫–æ—Ä–∞ (–∏—Å—Ö–æ–¥–Ω—ã–π –∏ —Å–≥–ª–∞–∂–µ–Ω–Ω—ã–π)
5. üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
